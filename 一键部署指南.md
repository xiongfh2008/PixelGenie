# 🚀 PixelGenie 一键部署指南

## 📋 部署前准备

### 1. 提交代码到 GitHub

```bash
# 添加所有更改
git add .

# 提交
git commit -m "feat: 准备部署到生产环境"

# 推送到 GitHub
git push origin main
```

---

## 🎯 推荐方案：Vercel 全栈部署（最简单）

### 为什么选择 Vercel？

- ✅ **一键部署** - 前端和后端同时部署
- ✅ **自动 HTTPS** - 免费 SSL 证书
- ✅ **全球 CDN** - 自动加速
- ✅ **零配置** - 自动检测框架
- ✅ **免费额度** - 个人项目完全够用
- ✅ **自动部署** - Git 推送自动触发

### 部署步骤（5 分钟完成）

#### 步骤 1: 访问 Vercel

1. 打开 [vercel.com](https://vercel.com)
2. 点击 **Sign Up** 或 **Log In**
3. 使用 GitHub 账号登录

#### 步骤 2: 导入项目

1. 点击 **Add New...** > **Project**
2. 选择 **Import Git Repository**
3. 找到并选择 `PixelGenie` 仓库
4. 点击 **Import**

#### 步骤 3: 配置项目

**Framework Preset**: Vite（自动检测）

**Root Directory**: `.` (默认)

**Build Command**: `npm run build`

**Output Directory**: `dist`

**Install Command**: `npm install`

#### 步骤 4: 配置环境变量（重要！）

在 **Environment Variables** 部分添加：

```
# Google API
GOOGLE_API_KEY=your_google_api_key_here

# Xunfei Spark API
XUNFEI_APP_ID=your_xunfei_app_id
XUNFEI_API_KEY=your_xunfei_api_key
XUNFEI_API_SECRET=your_xunfei_api_secret

# HuggingFace API
HUGGINGFACE_API_KEY=your_huggingface_api_key

# Cloudflare API (可选)
CLOUDFLARE_API_KEY=your_cloudflare_api_key
CLOUDFLARE_ACCOUNT_ID=your_cloudflare_account_id

# DeepSeek API (可选)
DEEPSEEK_API_KEY=your_deepseek_api_key

# 图像编辑 API (可选)
CLIPDROP_API_KEY=your_clipdrop_api_key
REMOVEBG_API_KEY=your_removebg_api_key
REPLICATE_API_TOKEN=your_replicate_token
STABILITY_API_KEY=your_stability_api_key
```

**注意**: 
- 将 `your_xxx_here` 替换为您的实际 API 密钥
- 至少需要配置 Google 或 Xunfei 的 API

#### 步骤 5: 部署

1. 点击 **Deploy**
2. 等待构建完成（约 2-5 分钟）
3. 部署成功！🎉

#### 步骤 6: 访问您的网站

部署成功后，Vercel 会提供一个 URL：
```
https://pixelgenie-xxx.vercel.app
```

---

## 🔧 Vercel 配置文件

项目已包含 `vercel.json` 配置文件：

```json
{
  "version": 2,
  "builds": [
    {
      "src": "package.json",
      "use": "@vercel/static-build",
      "config": {
        "distDir": "dist"
      }
    },
    {
      "src": "server/index.js",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "server/index.js"
    },
    {
      "src": "/(.*)",
      "dest": "/dist/$1"
    }
  ]
}
```

这个配置确保：
- ✅ 前端静态文件正确服务
- ✅ API 路由正确转发到后端
- ✅ 支持客户端路由

---

## 🌐 备选方案：Cloudflare Pages（仅前端）

### 适用场景

- 只需要部署前端
- 后端已有其他部署方案
- 需要极致的全球 CDN 性能

### 部署步骤

#### 步骤 1: 推送代码

```bash
git add .
git commit -m "feat: 准备部署到 Cloudflare Pages"
git push origin main
```

#### 步骤 2: 连接 Cloudflare Pages

1. 访问 [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. 选择 **Workers & Pages**
3. 点击 **Create application** > **Pages**
4. 连接 GitHub 仓库

#### 步骤 3: 配置构建

- **项目名称**: `pixelgenie`
- **生产分支**: `main`
- **构建命令**: `npm run build`
- **构建输出目录**: `dist`
- **环境变量**: `NODE_VERSION=18`

#### 步骤 4: 部署后端

后端需要单独部署到：
- Vercel
- Railway
- Render
- Heroku

然后在前端环境变量中配置：
```
VITE_API_URL=https://your-backend-url.com
```

---

## 📊 部署方案对比

| 方案 | 难度 | 前端 | 后端 | 价格 | 推荐度 |
|------|------|------|------|------|--------|
| **Vercel 全栈** | ⭐ 简单 | ✅ | ✅ | 免费 | ⭐⭐⭐⭐⭐ |
| Cloudflare Pages + Vercel 后端 | ⭐⭐ 中等 | ✅ | ✅ | 免费 | ⭐⭐⭐⭐ |
| Netlify | ⭐⭐ 中等 | ✅ | ⚠️ 有限 | 免费 | ⭐⭐⭐ |
| Railway | ⭐⭐⭐ 复杂 | ✅ | ✅ | 免费额度 | ⭐⭐⭐ |

---

## 🔐 环境变量管理

### 必需的环境变量

至少需要以下之一：

**Google Gemini**:
```
GOOGLE_API_KEY=AIzaSy...
```

**或 Xunfei Spark**:
```
XUNFEI_APP_ID=xxx
XUNFEI_API_KEY=xxx
XUNFEI_API_SECRET=xxx
```

### 可选的环境变量

**HuggingFace** (用于图像编辑):
```
HUGGINGFACE_API_KEY=hf_...
```

**图像编辑 API** (提升去水印效果):
```
CLIPDROP_API_KEY=xxx
REMOVEBG_API_KEY=xxx
```

### 在 Vercel 中添加环境变量

1. 进入项目设置
2. 点击 **Environment Variables**
3. 添加变量
4. 点击 **Save**
5. 重新部署（自动触发）

---

## 🚨 常见问题

### Q1: 部署后 API 调用失败

**原因**: 环境变量未配置

**解决**:
1. 检查 Vercel 环境变量是否正确配置
2. 重新部署项目
3. 检查浏览器控制台错误

### Q2: 页面显示空白

**原因**: 路由配置问题

**解决**:
1. 检查 `vercel.json` 配置
2. 确保 `dist` 目录正确生成
3. 检查浏览器控制台错误

### Q3: 构建失败

**原因**: 依赖安装失败或构建脚本错误

**解决**:
1. 本地测试构建: `npm run build`
2. 检查 `package.json` 脚本
3. 查看 Vercel 构建日志

### Q4: API 密钥泄露

**原因**: 密钥提交到 GitHub

**解决**:
1. 立即撤销泄露的密钥
2. 生成新的密钥
3. 只在 Vercel 环境变量中配置
4. 确保 `.env` 在 `.gitignore` 中

---

## 🎯 部署后检查清单

### ✅ 功能测试

- [ ] 访问网站 URL
- [ ] 测试智能鉴伪功能
- [ ] 测试智能去水印功能
- [ ] 测试文本翻译功能
- [ ] 检查所有页面加载正常
- [ ] 检查移动端显示

### ✅ 性能检查

- [ ] 页面加载速度 < 3 秒
- [ ] 图片加载正常
- [ ] API 响应时间 < 5 秒
- [ ] 无控制台错误

### ✅ 安全检查

- [ ] HTTPS 正常工作
- [ ] API 密钥未泄露
- [ ] 环境变量正确配置
- [ ] CORS 配置正确

---

## 📈 监控和维护

### Vercel Analytics

Vercel 自动提供：
- ✅ 访问量统计
- ✅ 性能监控
- ✅ 错误追踪
- ✅ 部署历史

### 查看日志

1. 进入 Vercel 项目
2. 点击 **Deployments**
3. 选择部署
4. 查看 **Build Logs** 或 **Function Logs**

### 自动部署

每次推送到 `main` 分支，Vercel 会自动：
1. 拉取最新代码
2. 安装依赖
3. 构建项目
4. 部署到生产环境

---

## 🎊 总结

### 推荐流程

1. **提交代码到 GitHub** ✅
2. **在 Vercel 导入项目** ✅
3. **配置环境变量** ✅
4. **点击部署** ✅
5. **访问您的网站** 🎉

### 预计时间

- 首次部署: 5-10 分钟
- 后续部署: 2-3 分钟（自动）

### 费用

- **Vercel 免费版**:
  - ✅ 无限部署
  - ✅ 100GB 带宽/月
  - ✅ 自动 HTTPS
  - ✅ 全球 CDN

对于个人项目完全够用！

---

**准备好了吗？立即开始部署！** 🚀

需要帮助？查看：
- 📄 `Cloudflare部署修复.md` - 详细的部署说明
- 📄 `vercel.json` - Vercel 配置文件
- 📄 `START_HERE.md` - 项目总体指南

