# 🚀 PixelGenie 完整启动说明

## ⚠️ 当前问题

您遇到的错误："**图片处理失败: 服务暂时不可用，请稍后重试**"

**原因**: 后端服务器（端口3001）没有运行

## ✅ 立即解决方案

### 第一步：启动后端服务器

**方法1：使用启动脚本（推荐）**

双击项目根目录的 **`启动后端服务器.bat`** 文件

这将：
- ✅ 自动检查并创建 `.env` 文件
- ✅ 启动后端服务器
- ✅ 显示服务器运行状态

**方法2：手动启动**

打开CMD或PowerShell，运行：
```cmd
cd D:\AIProject\PixelGenie\server
node index.js
```

**保持这个窗口打开！关闭窗口会停止服务器。**

### 第二步：配置API密钥（如果还没配置）

1. 打开 `D:\AIProject\PixelGenie\server\.env` 文件
2. 至少配置以下之一：

#### 选项A：Google Gemini（推荐）
```env
GOOGLE_API_KEY=你的Google API密钥
```
获取方式：https://aistudio.google.com/app/apikey  
免费额度：1,500次/天

#### 选项B：Cloudflare Workers AI
```env
CLOUDFLARE_API_TOKEN=你的Cloudflare令牌
CLOUDFLARE_ACCOUNT_ID=你的账号ID
```
获取方式：https://dash.cloudflare.com/profile/api-tokens  
免费额度：10,000次/天

#### 选项C：HuggingFace
```env
HUGGINGFACE_API_KEY=你的HuggingFace密钥
```
获取方式：https://huggingface.co/settings/tokens

3. 保存文件
4. 重启后端服务器

### 第三步：验证服务器运行

#### 方法1：检查端口
```cmd
netstat -ano | findstr ":3001"
```
应该看到类似输出：
```
TCP    0.0.0.0:3001    0.0.0.0:0    LISTENING    12345
```

#### 方法2：访问健康检查
在浏览器打开：
```
http://localhost:3001/api/health
```
应该看到：
```json
{
  "status": "ok",
  "message": "Server is running"
}
```

#### 方法3：查看服务器窗口
后端服务器窗口应该显示：
```
🚀 Server running on http://localhost:3001
📡 API Health Check: http://localhost:3001/api/health
⚠️ No API providers available. Server running but API functions will not work.
```

如果显示"No API providers available"，说明需要配置API密钥。

## 🎯 完整启动流程

### 每次使用项目时：

1. **启动后端**
   - 双击 `启动后端服务器.bat`
   - 或运行：`cd server && node index.js`

2. **启动前端**（如果还没运行）
   - 打开新的CMD窗口
   - 运行：`cd D:\AIProject\PixelGenie && npm run dev`

3. **访问应用**
   - 前端：http://localhost:5173
   - 后端：http://localhost:3001

4. **开始使用**
   - 上传图片
   - 使用智能鉴伪功能
   - 享受！

## 🔧 故障排查

### 问题1：服务器启动后立即退出

**可能原因**：
- 端口3001被占用
- Node.js版本过低（需要v18+）
- 代码语法错误

**解决方法**：
```cmd
# 检查并释放端口
netstat -ano | findstr ":3001"
# 如果有输出，记下PID，然后：
taskkill /PID <PID> /F

# 检查Node版本
node --version
# 应该显示 v18.0.0 或更高

# 重新启动
cd D:\AIProject\PixelGenie\server
node index.js
```

### 问题2：显示"No API providers available"

**原因**：没有配置API密钥

**解决**：
1. 编辑 `server\.env` 文件
2. 添加至少一个API密钥（见上面的配置说明）
3. 保存并重启服务器

### 问题3：前端无法连接后端

**症状**：前端显示"服务暂时不可用"

**检查清单**：
- [ ] 后端服务器正在运行（检查3001端口）
- [ ] 前端服务器正在运行（检查5173端口）
- [ ] 浏览器可以访问 http://localhost:3001/api/health
- [ ] 没有防火墙阻止连接

### 问题4：API密钥配置后仍然报错

**可能原因**：
- API密钥无效或过期
- API配额用完
- 网络连接问题

**解决**：
1. 验证API密钥是否正确
2. 检查API使用配额
3. 尝试使用其他API提供商

## 📋 快速命令参考

```cmd
# 启动后端
cd D:\AIProject\PixelGenie\server
node index.js

# 启动前端
cd D:\AIProject\PixelGenie
npm run dev

# 检查端口
netstat -ano | findstr ":3001"
netstat -ano | findstr ":5173"

# 检查Node进程
tasklist | findstr "node"

# 结束Node进程
taskkill /IM node.exe /F

# 访问健康检查
start http://localhost:3001/api/health
```

## 🎨 使用一键启动脚本

如果想同时启动前端和后端，可以使用：

**`快速启动.bat`** - 自动启动所有服务

这将：
1. ✅ 检查环境
2. ✅ 检查配置
3. ✅ 启动后端服务器
4. ✅ 启动前端服务器
5. ✅ 自动打开浏览器

## 💡 重要提示

1. **后端必须运行**
   - 智能鉴伪功能需要后端服务器
   - 图像分析需要调用AI API
   - 关闭后端窗口会停止服务

2. **API密钥安全**
   - 不要分享你的API密钥
   - 不要提交 `.env` 文件到Git
   - 定期轮换密钥

3. **免费额度**
   - Google Gemini: 1,500次/天
   - Cloudflare: 10,000次/天
   - 合理使用，避免浪费

## ✨ 成功标志

当一切正常时，您应该看到：

### 后端窗口：
```
🚀 Server running on http://localhost:3001
📡 API Health Check: http://localhost:3001/api/health
✅ Available API providers: google, cloudflare, huggingface
🔑 Active provider: google
```

### 前端窗口：
```
VITE v5.4.21  ready in 657 ms
➜  Local:   http://localhost:5173/
```

### 浏览器：
- 可以访问 http://localhost:5173
- 可以上传图片
- 智能鉴伪功能正常工作

---

**现在请按照上述步骤操作，启动后端服务器！**

如果还有问题，请告诉我具体的错误信息或截图。

